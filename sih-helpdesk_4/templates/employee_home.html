{% extends "base.html" %}
{% block title %}Dashboard — TicketEasy{% endblock %}

{% block content %}
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
  :root { --primary: #0f66d4; --teal: #12b0b0; --dark: #0f172a; --muted: #64748b; }

  .page-wrap { max-width: 1200px; margin: 30px auto; padding: 0 24px; font-family: 'Inter', sans-serif; }

  /* HERO HEADER */
  .dashboard-header {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0; border-radius: 16px; padding: 32px;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); margin-bottom: 32px;
  }
  .welcome-content h1 { font-size: 26px; font-weight: 800; color: var(--dark); margin: 0 0 6px 0; }
  .welcome-content p { color: var(--muted); font-size: 15px; margin: 0; }
  
  .header-actions { display: flex; gap: 12px; }
  .btn-action { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 10px; font-weight: 600; font-size: 14px; text-decoration: none; transition: all 0.2s ease; }
  .btn-raise { background: linear-gradient(90deg, var(--primary), var(--teal)); color: white; border: none; }
  .btn-raise:hover { transform: translateY(-2px); opacity: 0.95; }
  .btn-logout { background: white; border: 1px solid #e2e8f0; color: var(--muted); }
  .btn-logout:hover { background: #f8fafc; color: var(--dark); }

  /* STATS GRID */
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 40px; }
  .stat-card { background: white; padding: 24px; border-radius: 16px; border: 1px solid #f1f5f9; box-shadow: 0 2px 10px rgba(0,0,0,0.03); position: relative; display: flex; flex-direction: column; justify-content: space-between; height: 140px; transition: transform 0.2s; }
  .stat-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.06); }
  
  /* Stat Borders */
  .card-blue { border-left: 4px solid #3b82f6; }
  .card-orange { border-left: 4px solid #f59e0b; }
  .card-purple { border-left: 4px solid #8b5cf6; }
  .card-green { border-left: 4px solid #10b981; }
  
  .stat-icon { position: absolute; top: 20px; right: 20px; font-size: 32px; opacity: 0.15; }
  .stat-label { font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; }
  .stat-value { font-size: 36px; font-weight: 800; color: var(--dark); }
  .stat-sub { font-size: 13px; color: #94a3b8; margin-top: auto; }

  /* RECENT TICKETS */
  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .section-title { font-size: 20px; font-weight: 700; color: var(--dark); display: flex; align-items: center; gap: 8px; }
  .link-sm { font-size: 14px; font-weight: 600; color: var(--primary); text-decoration: none; }

  /* TABLE */
  .table-container { background: white; border-radius: 16px; border: 1px solid #e2e8f0; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02); }
  table { width: 100%; border-collapse: collapse; }
  thead { background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
  th { text-align: left; padding: 18px 24px; font-size: 12px; font-weight: 700; color: var(--muted); text-transform: uppercase; }
  td { padding: 18px 24px; font-size: 14px; color: #334155; border-bottom: 1px solid #f1f5f9; }
  tr:last-child td { border-bottom: none; }
  tr:hover { background: #f8fafc; cursor: pointer; }

  /* BADGES */
  .badge { padding: 6px 12px; border-radius: 30px; font-size: 11px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; }
  .p-high { background: #fef2f2; color: #ef4444; border: 1px solid #fee2e2; }
  .p-med { background: #fffbeb; color: #f59e0b; border: 1px solid #fef3c7; }
  .p-low { background: #f0fdf4; color: #16a34a; border: 1px solid #dcfce7; }
  
  .s-open { background: #eff6ff; color: #3b82f6; }
  .s-in-progress { background: #faf5ff; color: #8b5cf6; }
  .s-resolved { background: #f0fdfa; color: #0d9488; }
</style>

<div class="page-wrap">
  <div class="dashboard-header">
    <div class="welcome-content">
      <h1>Hello, {{ user.name }}</h1>
      <p>Here is an overview of your support requests.</p>
    </div>
    <div class="header-actions">
      <a href="{{ url_for('logout') }}" class="btn-action btn-logout"><i class="ph ph-sign-out"></i> Sign Out</a>
      <a href="{{ url_for('raise_ticket') }}" class="btn-action btn-raise"><i class="ph ph-plus-circle"></i> Raise Ticket</a>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card card-blue">
      <i class="ph ph-files stat-icon" style="color: #3b82f6;"></i>
      <div class="stat-label">Total</div>
      <div class="stat-value">{{ stats.total }}</div>
      <div class="stat-sub">Lifetime requests</div>
    </div>
    <div class="stat-card card-orange">
      <i class="ph ph-hourglass stat-icon" style="color: #f59e0b;"></i>
      <div class="stat-label">Open</div>
      <div class="stat-value">{{ stats.open }}</div>
      <div class="stat-sub">Waiting for action</div>
    </div>
    <div class="stat-card card-purple">
      <i class="ph ph-gear-fine stat-icon" style="color: #8b5cf6;"></i>
      <div class="stat-label">In Progress</div>
      <div class="stat-value">{{ stats.in_progress }}</div>
      <div class="stat-sub">Being worked on</div>
    </div>
    <div class="stat-card card-green">
      <i class="ph ph-check-circle stat-icon" style="color: #10b981;"></i>
      <div class="stat-label">Resolved</div>
      <div class="stat-value">{{ stats.resolved }}</div>
      <div class="stat-sub">Successfully closed</div>
    </div>
  </div>

  <div class="section-header">
    <div class="section-title"><i class="ph ph-clock-counter-clockwise"></i> Recent Activity</div>
    <a href="{{ url_for('emp_history') }}" class="link-sm">View all history →</a>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Subject</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for ticket in recent %}
        <tr onclick="window.location='{{ url_for('ticket_detail', ticket_id=ticket.id) }}'">
          <td><span style="font-family:monospace; color:#64748b;">#{{ ticket.id }}</span></td>
          <td style="font-weight: 600; color: #1e293b;">{{ ticket.subject }}</td>
          <td>
            <span class="badge p-{{ 'high' if ticket.priority=='high' else ('med' if ticket.priority=='medium' else 'low') }}">
              {{ ticket.priority|capitalize }}
            </span>
          </td>
          <td>
            <span class="badge s-{{ ticket.status|lower|replace(' ', '-') }}">
              {{ ticket.status|title }}
            </span>
          </td>
          <td>{{ ticket.created_at.strftime('%Y-%m-%d') }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="5" style="text-align:center; padding: 40px; color: var(--muted);">
            No tickets found. Click "Raise Ticket" to start.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}