{% extends "base.html" %}
{% block title %}Admin Dashboard â€” TicketEasy{% endblock %}

{% block content %}
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
  :root {
    --primary: #0f66d4;
    --teal: #12b0b0;
    --dark: #0f172a;
    --muted: #64748b;
  }

  .page-wrap {
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px;
    font-family: 'Inter', sans-serif;
  }

  /* HEADER */
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }

  .welcome-box h1 {
    font-size: 24px;
    font-weight: 800;
    color: var(--dark);
    margin: 0;
  }

  .welcome-box p {
    color: var(--muted);
    margin: 4px 0 0 0;
    font-size: 14px;
  }

  .header-actions {
    display: flex;
    gap: 12px;
  }

  .btn-logout {
    padding: 10px 20px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    color: var(--muted);
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: 0.2s;
  }

  .btn-logout:hover {
    background: #f8fafc;
    color: var(--dark);
    border-color: #cbd5e1;
  }

  /* STATS CARDS */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .stat-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-val {
    font-size: 32px;
    font-weight: 800;
    color: var(--dark);
  }

  .sc-blue {
    border-bottom: 4px solid #3b82f6;
  }

  .sc-orange {
    border-bottom: 4px solid #f97316;
  }

  .sc-purple {
    border-bottom: 4px solid #a855f7;
  }

  .sc-green {
    border-bottom: 4px solid #22c55e;
  }

  /* TICKET TABLE */
  .table-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
  }

  .table-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e2e8f0;
    background: #f8fafc;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .table-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--dark);
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th {
    text-align: left;
    padding: 16px 24px;
    font-size: 12px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
  }

  td {
    padding: 16px 24px;
    font-size: 14px;
    color: #334155;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
  }

  tr:last-child td {
    border-bottom: none;
  }

  tr:hover {
    background: #fdfdfd;
  }

  /* BADGES & BUTTONS */
  .badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .p-high {
    background: #fee2e2;
    color: #ef4444;
  }

  .p-med {
    background: #ffedd5;
    color: #f97316;
  }

  .p-low {
    background: #dcfce7;
    color: #16a34a;
  }

  .btn-manage {
    padding: 6px 14px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    color: var(--primary);
    font-weight: 600;
    font-size: 13px;
    text-decoration: none;
    transition: 0.2s;
    display: inline-block;
  }

  .btn-manage:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }
</style>

<div class="page-wrap">

  <div class="dashboard-header">
    <div class="welcome-box">
      <h1>Agent Dashboard</h1>
      <p>Welcome back, {{ admin.name }}. You are logged in as <strong>{{ admin.role|title }}</strong>.</p>
    </div>
    <div class="header-actions">
      <a href="{{ url_for('logout') }}" class="btn-logout"><i class="ph ph-sign-out"></i> Logout</a>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card sc-blue">
      <span class="stat-label">Assigned to Me</span>
      <span class="stat-val">{{ stats.total }}</span>
    </div>
    <div class="stat-card sc-orange">
      <span class="stat-label">Open / Pending</span>
      <span class="stat-val">{{ stats.open }}</span>
    </div>
    <div class="stat-card sc-purple">
      <span class="stat-label">In Progress</span>
      <span class="stat-val">{{ stats.in_progress }}</span>
    </div>
    <div class="stat-card sc-green">
      <span class="stat-label">Resolved</span>
      <span class="stat-val">{{ stats.resolved }}</span>
    </div>
  </div>

  <div class="table-card">
    <div class="table-header">
      <span class="table-title">Assigned Tickets</span>
    </div>
    <table>
      <thead>
        <tr>
          <th width="80">ID</th>
          <th>Subject</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Category</th>
          <th>Date</th>
          <th width="100">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for ticket in tickets %}
        <tr>
          <td><span style="font-family: monospace; color: var(--muted);">#{{ ticket.id }}</span></td>
          <td style="font-weight: 600; color: var(--dark);">{{ ticket.subject }}</td>
          <td>
            <span
              class="badge p-{{ 'high' if ticket.priority=='high' else ('med' if ticket.priority=='medium' else 'low') }}">
              {{ ticket.priority|capitalize }}
            </span>
          </td>
          <td>
            <span
              style="font-weight: 600; font-size: 13px; color: {{ '#3b82f6' if ticket.status=='open' else ('#a855f7' if ticket.status=='in-progress' else '#22c55e') }}">
              {{ ticket.status|title }}
            </span>
          </td>
          <td>{{ ticket.category }}</td>
          <td>{{ ticket.created_at.strftime('%Y-%m-%d') }}</td>
          <td>
            <a href="{{ url_for('ticket_detail', ticket_id=ticket.id) }}" class="btn-manage">Manage</a>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" style="text-align: center; padding: 40px; color: var(--muted);">
            No tickets assigned to you yet. Great job!
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}